# Prometheus Configuration
# ============================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: "church-app-monitor"

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

# Alert rules
rule_files:
  - /etc/prometheus/alerts.yml

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  # Node Exporter - System metrics
  - job_name: "node"
    static_configs:
      - targets: ["node-exporter:9100"]

  # cAdvisor - Container metrics
  - job_name: "cadvisor"
    static_configs:
      - targets: ["cadvisor:8080"]

  # Church App Backend
  - job_name: "church-app-backend"
    metrics_path: /metrics
    static_configs:
      - targets: ["backend:3000"]
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: "church-app-backend"

  # PostgreSQL (if using postgres_exporter)
  - job_name: "postgresql"
    static_configs:
      - targets: ["postgres-exporter:9187"]
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: "church-app-db"

  # Redis (if using redis_exporter)
  - job_name: "redis"
    static_configs:
      - targets: ["redis-exporter:9121"]
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: "church-app-redis"

  # Blackbox Exporter - HTTP probes
  - job_name: "blackbox-http"
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      - targets:
          - http://backend:3000/health
          - http://frontend:80/health
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox-exporter:9115
